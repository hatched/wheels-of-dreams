YUI.add("gallery-flickr-carousel",function(e,t){var n=e.Lang.sub;e.FlickrCarousel=new e.Base.create("gallery-flickr-carousel",e.ScrollView,[],{_flickrUrl:"http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key={apiKey}&photoset_id={photosetId}&extras={size},description&format=json",imageCarouselTemplate:"<ul/>",imageTemplate:'<li class="img-container" style="width: {width}"><img src="{src}" alt="{title}" width="{imgWidth}" height="{imgHeight}"></li>',prevNavTemplate:'<div class="navigate prev"></div>',nextNavTemplate:'<div class="navigate next"></div>',descriptionTemplate:'<div class="description">{description}</div>',_photoSizeToKeyUrl:[{key:"sq",x:75,y:75},{key:"t",x:100,y:75},{key:"q",x:150,y:150},{key:"s",x:240,y:180},{key:"n",x:320,y:240},{key:"m",x:500,y:375},{key:"z",x:640,y:480},{key:"c",x:800,y:600},{key:"l",x:1024,y:768},{key:"o",x:2400,y:1800}],initializer:function(t){this.plug(e.Plugin.ScrollViewPaginator,{selector:"li"}),this.determinePhotoSize(),this.fetchCarouselImages(t.apiKey,t.photosetId)},determinePhotoSize:function(){var t=parseInt(this.get("width"),10),n=this._photoSizeToKeyUrl,r;e.Array.some(n,function(e){if(e.x>=t)return r=e.key,!0},this),r||(r=n[n.length].key),this.set("_photoSizeParam",r)},fetchCarouselImages:function(t,r){var i=n(this._flickrUrl,{apiKey:t,photosetId:r,size:this.get("_photoSizeParam")});i+="&jsoncallback={callback}",e.jsonp(i,e.bind(this._handleResponse,this))},_handleCarouselNavigate:function(e){var t=this.pages;e.currentTarget.hasClass("next")===!0?t.next():t.prev(),this._advanceDescription()},_advanceDescription:function(e){e===undefined&&(e=this.pages.get("index")),this.get("_descriptionNode").setHTML(this.get("photos")[e].description._content)},_generateCarouselControls:function(){var e=this.get("boundingBox");e.append(this.prevNavTemplate),e.append(this.nextNavTemplate)},_addDescriptionNode:function(t){var r=this.get("boundingBox"),i=n(this.descriptionTemplate,{description:t}),s=e.Node.create(i);this.set("_descriptionNode",s),r.append(s)},_advanceImage:function(){var e=this.pages,t=e.get("index");t<e.get("total")-1?e.next():e.scrollToIndex(0),this._advanceDescription()},_handleResponse:function(t){var r=t.photoset.photo,i=this.get("srcNode"),s=this.get("_photoSizeParam"),o=e.Node.create(this.imageCarouselTemplate),u=s.split("_")[1],a=this.get("width"),f="",l,c,h,p,d;this.set("photos",r);for(p=0;p<r.length;p++)l=r[p],c=l["width_"+u],h=l["height_"+u],c>a&&(c=a,h*=a/c),f+=n(this.imageTemplate,{width:this.get("width"),src:l[s],title:l.title,imgWidth:c,imgHeight:h});o.setHTML(f),i.setHTML(o),this.render(),this._generateCarouselControls(),this.get("showDescription")===!0&&this._addDescriptionNode(r[0].description._content)},_checkForAutoAdvance:function(){this.get("autoAdvance")===!0&&e.later(this.get("startDelay"),this,function(){this.get("pauseOnHover")!==!0&&this._advanceImage(),e.later(this.get("advanceDelay"),this,function(){this.get("pauseOnHover")!==!0&&this._advanceImage()},null,!0)})},_pauseAutoAdvance:function(e){e.type==="mouseenter"?this.set("pauseOnHover",!0):this.set("pauseOnHover",!1)},bindUI:function(){e.FlickrCarousel.superclass.bindUI.apply(this);var t=this.get("_events"),n=this.get("boundingBox");t.push(n.delegate("click",this._handleCarouselNavigate,".navigate",this)),t.push(this.after("render",this._checkForAutoAdvance,this)),t.push(n.on("mouseenter",this._pauseAutoAdvance,this)),t.push(n.on("mouseleave",this._pauseAutoAdvance,this))},destructor:function(){this.get("_events").each(function(e){e.detach()})}},{ATTRS:{apiKey:{},photosetId:{},autoAdvance:{value:!0},startDelay:{value:3e3},advanceDelay:{value:3e3},pauseOnHover:{value:!1},flick:{value:!1},photos:{value:[]},showDescription:{value:!0},drag:{value:!1},_photoSizeParam:{value:"url_m",setter:function(e){return"url_"+e}},_descriptionNode:{value:{}},_events:{value:[]}}})},"0.2.0",{requires:["scrollview","scrollview-paginator","base-build","jsonp","event-mouseenter"],skinnable:!1});
